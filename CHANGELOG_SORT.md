# 目标排序功能更新日志

## 更新日期
2026-01-26

## 更新内容

### 新增功能：目标智能排序

在所有涉及目标列表展示的页面中，增加了统一的排序逻辑，提升评审效率和用户体验。

### 排序规则

#### 1. 首先按目标类型优先级排序
- **业务目标** (business) - 优先级 1，排在最前
- **组织与人员管理&团队建设** (team) - 优先级 2，排在中间
- **个人能力提升** (skill) - 优先级 3，排在最后

#### 2. 同类型内按权重倒序排列
在同一类型的目标中，权重高的排在前面。

**示例**：
```
业务目标 A - 权重 40%  ⬆️ 排第1
业务目标 B - 权重 30%  ⬆️ 排第2
组织与人员管理 - 权重 20%  ⬇️ 排第3
个人能力提升 - 权重 10%  ⬇️ 排第4
```

### 技术实现

#### 新增文件
- `frontend/src/utils/goalSort.ts` - 通用排序工具函数

```typescript
export function sortGoals(goals: PbcGoal[]): PbcGoal[] {
  return [...goals].sort((a, b) => {
    // 1. 按目标类型优先级排序
    const typePriorityA = goalTypePriority[a.goal_type] || 999;
    const typePriorityB = goalTypePriority[b.goal_type] || 999;
    
    if (typePriorityA !== typePriorityB) {
      return typePriorityA - typePriorityB;
    }
    
    // 2. 同类型内按权重倒序
    const weightA = Number(a.goal_weight) || 0;
    const weightB = Number(b.goal_weight) || 0;
    return weightB - weightA;
  });
}
```

#### 修改的页面

1. **ReviewList.tsx（审核管理页面）**
   - 查看目标详情Modal中的卡片列表
   - 使用 `sortGoals(viewDetailGroup.goals)`

2. **TeamGoals.tsx（团队目标查看页面）**
   - 查看目标详情Modal中的卡片列表
   - 查看自评Modal中的目标表格
   - 使用 `sortGoals(viewDetailGroup.goals)` 和 `sortGoals(currentEvaluationData.goals)`

3. **PBCList.tsx（我的PBC页面）**
   - 主目标列表表格
   - 查看反馈Modal中的目标表格
   - 使用 `sortGoals(data)` 和 `sortGoals(feedbackData.goals)`

### 更新的文档

1. **README.md**
   - 新增"目标排序规则"章节
   - 详细说明排序逻辑和目的

2. **require.md**
   - 在"目标类型说明"后新增"目标排序规则"章节
   - 说明技术实现细节

### 业务价值

#### 1. 提升评审效率
- 评审者首先看到最重要的业务目标
- 减少寻找关键目标的时间
- 优化评审流程

#### 2. 突出重点目标
- 权重高的目标自动排在前面
- 清晰展示目标重要性层次
- 便于快速决策

#### 3. 统一用户体验
- 所有页面使用相同的排序逻辑
- 一致的浏览习惯
- 降低学习成本

### 排序应用场景

| 页面 | 排序位置 | 说明 |
|------|---------|------|
| 我的PBC | 主列表 | 员工查看自己的目标 |
| 审核管理 | 查看详情弹窗 | 主管审核员工目标 |
| 团队目标 | 查看目标弹窗 | 查看团队成员目标 |
| 团队目标 | 查看自评弹窗 | 查看员工自评详情 |
| 我的PBC | 查看反馈弹窗 | 员工查看主管反馈 |

### 编译结果

✅ 前端编译成功
- 文件大小：413.22 kB (+105 B)
- 无 TypeScript 错误
- 无运行时错误

### 测试建议

#### 测试场景1：业务目标优先
1. 创建多个不同类型的目标
2. 查看列表，验证业务目标排在最前

#### 测试场景2：权重排序
1. 创建多个相同类型但不同权重的目标
2. 验证权重高的排在前面

#### 测试场景3：混合排序
1. 创建混合目标：
   - 业务目标 20%
   - 业务目标 50%
   - 个人能力提升 10%
   - 组织与人员管理 20%
2. 期望顺序：
   - 业务目标 50%（第1）
   - 业务目标 20%（第2）
   - 组织与人员管理 20%（第3）
   - 个人能力提升 10%（第4）

### 后续优化建议

1. **可配置排序**：允许用户自定义排序规则
2. **排序指示器**：在列表头部添加排序说明提示
3. **手动排序**：提供拖拽功能支持手动调整顺序
4. **排序偏好记忆**：记住用户的排序偏好

## 开发者备注

- 排序函数为纯函数，不会修改原数组
- 使用扩展运算符 `[...goals]` 创建副本
- 未知类型默认优先级为 999，排在最后
- 权重为空或非法值时按 0 处理

## 相关链接

- 排序工具函数：`frontend/src/utils/goalSort.ts`
- 需求文档：`require.md` - "目标排序规则"章节
- 用户手册：`README.md` - "目标排序规则"章节
